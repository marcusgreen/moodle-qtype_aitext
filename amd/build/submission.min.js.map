{"version":3,"file":"submission.min.js","sources":["../src/submission.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Handle form submission for aitext questions with spinner.\n *\n * @module     qtype_aitext/submission\n * @copyright  2024 Marcus Green\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport {\n    addIconToContainer\n} from 'core/loadingicon';\n\n/**\n * Initialize submission handling for aitext questions.\n */\nexport const init = () => {\n    // Find the form and the submit button.\n    const questionContainer = document.querySelector('.que.aitext');\n    if (!questionContainer) {\n        return;\n    }\n    const submitButton = questionContainer.querySelector('button[id^=\"q\"][id$=\"-submit\"]');\n    const form = questionContainer.closest('form');\n\n    if (!submitButton || !form) {\n        return;\n    }\n\n    // When the submit button is clicked, show the spinner.\n    submitButton.addEventListener('click', function(e) {\n        // Show a spinner as an overlay on top of the submit button for better user feedback.\n        const spinnerContainer = document.createElement('div');\n        spinnerContainer.className = 'aitext-spinner-overlay';\n        spinnerContainer.style.position = 'relative';\n        spinnerContainer.style.display = 'inline-block';\n\n        // Wrap the submit button with the overlay container\n        submitButton.parentNode.insertBefore(spinnerContainer, submitButton);\n        spinnerContainer.appendChild(submitButton);\n\n        // Create inner container for the spinner\n        const spinnerInner = document.createElement('div');\n        spinnerInner.className = 'qtype_aitext_spinnerInner';\n\n        spinnerContainer.appendChild(spinnerInner);\n\n        // Show the spinner in the overlay container.\n        addIconToContainer(spinnerInner).then(() => {\n            submitButton.disabled = true;\n            submitButton.style.opacity = '0.7';\n            spinnerContainer.dataset.spinnerActive = 'true';\n            return true;\n        }).catch(() => {\n            // Restore the original DOM structure if there's an error.\n            spinnerContainer.parentNode.insertBefore(submitButton, spinnerContainer);\n            spinnerContainer.remove();\n        });\n\n        // Prevent the default form submission to give the spinner time to appear.\n        e.preventDefault();\n\n        // Get the button's name and value, as they are not submitted with form.submit().\n        const buttonName = submitButton.getAttribute('name');\n        const buttonValue = submitButton.getAttribute('value');\n\n        // Create a hidden input to carry the button's data.\n        if (buttonName) {\n            const input = document.createElement('input');\n            input.type = 'hidden';\n            input.name = buttonName;\n            input.value = buttonValue || '';\n            form.appendChild(input);\n        }\n\n        // The spinner will be hidden automatically when the page reloads after submission.\n        // We use a small timeout to allow the browser to render the spinner before submitting the form.\n        setTimeout(function() {\n            form.submit();\n        }, 100);\n    });\n};"],"names":["questionContainer","document","querySelector","submitButton","form","closest","addEventListener","e","spinnerContainer","createElement","className","style","position","display","parentNode","insertBefore","appendChild","spinnerInner","then","disabled","opacity","dataset","spinnerActive","catch","remove","preventDefault","buttonName","getAttribute","buttonValue","input","type","name","value","setTimeout","submit"],"mappings":"4LA8BoB,WAEVA,kBAAoBC,SAASC,cAAc,mBAC5CF,+BAGCG,aAAeH,kBAAkBE,cAAc,kCAC/CE,KAAOJ,kBAAkBK,QAAQ,QAElCF,cAAiBC,MAKtBD,aAAaG,iBAAiB,SAAS,SAASC,SAEtCC,iBAAmBP,SAASQ,cAAc,OAChDD,iBAAiBE,UAAY,yBAC7BF,iBAAiBG,MAAMC,SAAW,WAClCJ,iBAAiBG,MAAME,QAAU,eAGjCV,aAAaW,WAAWC,aAAaP,iBAAkBL,cACvDK,iBAAiBQ,YAAYb,oBAGvBc,aAAehB,SAASQ,cAAc,OAC5CQ,aAAaP,UAAY,4BAEzBF,iBAAiBQ,YAAYC,kDAGVA,cAAcC,MAAK,KAClCf,aAAagB,UAAW,EACxBhB,aAAaQ,MAAMS,QAAU,MAC7BZ,iBAAiBa,QAAQC,cAAgB,QAClC,KACRC,OAAM,KAELf,iBAAiBM,WAAWC,aAAaZ,aAAcK,kBACvDA,iBAAiBgB,YAIrBjB,EAAEkB,uBAGIC,WAAavB,aAAawB,aAAa,QACvCC,YAAczB,aAAawB,aAAa,YAG1CD,WAAY,OACNG,MAAQ5B,SAASQ,cAAc,SACrCoB,MAAMC,KAAO,SACbD,MAAME,KAAOL,WACbG,MAAMG,MAAQJ,aAAe,GAC7BxB,KAAKY,YAAYa,OAKrBI,YAAW,WACP7B,KAAK8B,WACN"}